!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).Uxpl={})}(this,(function(t){"use strict";function e(t,e,s,o){return n(t,e,(function(t){var e=t.target.closest(s);e&&o(e,t)}),!1)}function n(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return t.addEventListener.apply(t,e),function(){t.removeEventListener.apply(t,e)}}var s=function(){this.listeners={}};function o(t,e){return Object.assign({},t,e)}s.prototype.addEventListener=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},s.prototype.removeEventListener=function(t,e){this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter((function(t){return t!==e})))},s.prototype.dispatchEvent=function(t,e){this.listeners[t]&&this.listeners[t].forEach((function(t){return t(e)}))},s.prototype.clearAll=function(){this.listeners={}};function i(t,e){if((n=t)&&1===n.nodeType)return t;var n,s=e.parent,o=e.selector,i=e.throwIfNotFound,r=s.querySelector(o);if(!r&&i)throw new Error(i);return r}function r(t,e){var n=t.getAttribute(e);n="true"===n?"false":"true",t.setAttribute(e,n)}var l={toggler:'[data-pl-dropdown-role="toggler"]',target:'[data-pl-dropdown-role="target"]'},a=function(t,e){this.dropdown=t,this.__mergeOptions=o,e=this.__mergeOptions(l,e),this.toggler=this.__resolveElement(e.toggler,this.dropdown,l.toggler),this.target=this.__resolveElement(e.target,this.dropdown,l.target),this.shownClass="is-shown",this.dispatcher=new s,this.__init()};a.prototype.addEventListener=function(t,e){this.dispatcher.addEventListener(t,e)},a.prototype.removeEventListener=function(t,e){this.dispatcher.removeEventListener(t,e)},a.prototype.destroy=function(){this.dropdown=null,this.toggler=null,this.target=null,this.currentDocumentListener=null,this.dispatcher.clearAll()},a.prototype.isOpen=function(){return this.target&&this.target.classList&&this.target.classList.contains(this.shownClass)},a.prototype.closeDropdown=function(){this.dispatcher.dispatchEvent("beforeHide",this),this.target.classList.remove(this.shownClass),this.dispatcher.dispatchEvent("afterHide",this),this.toggler.setAttribute("aria-expanded","false"),this.__cleanDocListner()},a.prototype.openDropdown=function(){this.dispatcher.dispatchEvent("beforeShow",this),this.target.classList.add(this.shownClass),this.dispatcher.dispatchEvent("afterShow",this),this.toggler.setAttribute("aria-expanded","true"),this.__attachDocListener()},a.prototype.__resolveElement=function(t,e,n){return this.__isObject(t)?t:e.querySelector(n)},a.prototype.__isObject=function(t){return"object"==typeof t&&null!==t},a.prototype.__toggleDropdown=function(){this.isOpen()?this.closeDropdown():this.openDropdown()},a.prototype.__attachDocListener=function(){var t=this;this.isOpen()&&(this.currentDocumentListener&&this.__cleanDocListner(),this.currentDocumentListener=function(e){e.target&&e.target!==t.toggler&&e.target.parentElement!==t.toggler&&t.closeDropdown()},document.addEventListener("click",this.currentDocumentListener))},a.prototype.__cleanDocListner=function(){document.removeEventListener("click",this.currentDocumentListener),this.currentDocumentListener=null},a.prototype.__init=function(){this.toggler.addEventListener("click",this.__toggleDropdown.bind(this))};var c='[data-pl-globalnav-role="navbar"]',d='[data-pl-globalnav-role="close"]',h='[data-pl-globalnav-role="open"]',p='[data-pl-globalnav-role="menu"]',u="data-pl-globalnav-content-id",m='[data-pl-globalnav-role="backdrop"]',_='[data-pl-globalnav-role="panel"]',v="is-open",f="is-panel-open",g="is-selected",E=function(t,e){this.globalNav=t,this.domElements={navbar:i(e&&e.globalNav?e.globalNav:null,{parent:this.globalNav,selector:c}),close:i(e&&e.close?e.close:null,{parent:this.globalNav,selector:d}),open:i(e&&e.open?e.open:null,{parent:this.globalNav,selector:h}),menu:i(e&&e.menu?e.menu:null,{parent:this.globalNav,selector:p}),backdrop:i(e&&e.backdrop?e.backdrop:null,{parent:this.globalNav,selector:m}),panel:i(e&&e.panel?e.globalNav:null,{parent:this.globalNav,selector:_})},this.dispatcher=new s,this.__attachListeners(),this.__screenWidthChangeHandler()};E.prototype.addEventListener=function(t,e){this.dispatcher.addEventListener(t,e)},E.prototype.removeEventListener=function(t,e){this.dispatcher.removeEventListener(t,e)},E.prototype.destroy=function(){this.globalNav=null,this.domElements=null,this.dispatcher.clearAll(),this.__eventDisposers.forEach((function(t){return t()}))},E.prototype.isPanelOpen=function(){return this.globalNav&&this.globalNav.classList&&this.globalNav.classList.contains(f)},E.prototype.close=function(){this.__clearActiveItem(),this.__togglePanelContent(),this.globalNav.classList.toggle(f),r(this.domElements.panel,"aria-hidden"),r(this.domElements.backdrop,"aria-hidden")},E.prototype.open=function(t){var e="["+u+'="'+t+'"]',n=i(null,{parent:this.domElements.navbar,selector:e});if(n){if(this.isPanelOpen()){var s=this.domElements.menu.querySelector("."+g);this.__removeActiveState(s),r(s,"aria-expanded"),this.__togglePanelContent(n,s)}else this.__togglePanelContent(n),this.globalNav.classList.toggle(f),r(this.domElements.panel,"aria-hidden"),r(this.domElements.backdrop,"aria-hidden");this.__addActiveState(n),r(n,"aria-expanded")}else console.warn('Global Nav Component: could not find action with id "'+t+'"')},E.prototype.__isBackdropOpen=function(){return this.domElements.backdrop&&this.domElements.backdrop.classList&&this.domElements.backdrop.classList.contains(v)},E.prototype.__isPanelContentShown=function(t){return t&&t.classList&&t.classList.contains(v)},E.prototype.__addActiveState=function(t){t.classList.add(g)},E.prototype.__removeActiveState=function(t){t.classList.remove(g)},E.prototype.__clearActiveItem=function(){var t=this.domElements.menu.querySelector("."+g);null!==t&&(t.classList.remove(g),r(t,"aria-expanded"))},E.prototype.__toggleVisibility=function(t,e){t&&(t.classList[e?"remove":"add"](v),t.setAttribute("aria-hidden",e))},E.prototype.__togglePanelContent=function(t,e){var n=this;if(this.domElements.panel){var s=[];if(t){var o=t.getAttribute(u),i=this.domElements.panel.querySelector("[ "+u+" = "+o+" ]");s.push(i)}if(e||!t&&!e){var r=this.domElements.panel.querySelector("[ "+u+"].is-open");s.push(r)}s.forEach((function(t){t&&(n.__isPanelContentShown(t)?(n.dispatcher.dispatchEvent("beforeHide",t),n.__toggleVisibility(t,n.__isPanelContentShown(t)),n.dispatcher.dispatchEvent("afterHide",t)):(n.dispatcher.dispatchEvent("beforeShow",t),n.__toggleVisibility(t,n.__isPanelContentShown(t)),n.dispatcher.dispatchEvent("afterShow",t)))}))}},E.prototype.__menuActionHandler=function(t){if(t===this.domElements.menu.querySelector("."+g))this.close();else{var e=t.getAttribute(u);this.open(e)}},E.prototype.__screenWidthChangeHandler=function(){var t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,e=this.domElements.open.getAttribute("aria-hidden"),n=this.domElements.menu.getAttribute("aria-hidden");t>1023?("false"==e&&r(this.domElements.open,"aria-hidden"),"true"==n&&r(this.domElements.menu,"aria-hidden")):("true"==e&&r(this.domElements.open,"aria-hidden"),"false"==n&&r(this.domElements.menu,"aria-hidden"))},E.prototype.__attachListeners=function(){var t=this;this.__eventDisposers=[],this.__eventDisposers.push(e(this.domElements.menu,"click","["+u+"]",this.__menuActionHandler.bind(this))),this.domElements.backdrop&&this.__eventDisposers.push(n(this.domElements.backdrop,"click",this.close.bind(this))),this.domElements.close&&this.__eventDisposers.push(n(this.domElements.close,"click",(function(){t.globalNav.classList.toggle(f),r(t.domElements.panel,"aria-hidden"),r(t.domElements.open,"aria-hidden"),r(t.domElements.close,"aria-hidden"),r(t.domElements.menu,"aria-hidden"),t.__clearActiveItem(),t.__togglePanelContent()}))),this.domElements.open&&this.__eventDisposers.push(n(this.domElements.open,"click",(function(){t.globalNav.classList.toggle(f),r(t.domElements.panel,"aria-hidden"),r(t.domElements.open,"aria-hidden"),r(t.domElements.close,"aria-hidden"),r(t.domElements.menu,"aria-hidden");var e=t.domElements.menu.querySelector("["+u+"]");t.__addActiveState(e),t.__togglePanelContent(e)}))),this.__eventDisposers.push(n(window,"resize",this.__screenWidthChangeHandler.bind(this)))};var y='[data-pl-leftnav-role="menu"]',b='[data-pl-leftnav-role="collapse"]',L='[data-pl-leftnav-role="dropdown"]',w='[data-pl-leftnav-role="menu-link"]',D='[data-pl-leftnav-role="menu-item"]',k='[data-pl-leftnav-role="nested-menu"]',A="is-active",N="is-open",C="is-collapsed",S="is-scrollable",x=function(t){this.__initElements(t),this.__domElements.collapse&&(this.__destroyListeners=n(this.__domElements.collapse,"click",this.__handleCollapse.bind(this)))};function H(t){null!==t&&(t.classList.remove(A),t.classList.contains(N)&&(t.classList.remove(N),r(t,"aria-expanded")))}x.prototype.destroy=function(){this.__domElements=null,this.__destroyListeners&&this.__destroyListeners()},x.prototype.__handleCollapse=function(){var t=this.__domElements.layoutRoot;t&&t.classList.toggle(C)},x.prototype.__initElements=function(t){var e=t.layoutRoot,n=e?i(t.collapse,{parent:e,selector:b}):null;this.__domElements={layoutRoot:e,collapse:n}};var O=function(t){this.__domElements={menu:t},this.__attachListeners()};O.prototype.destroy=function(){this.__domElements=null,this.__eventDisposers.forEach((function(t){return t()}))},O.prototype.__clearActiveItems=function(){var t=this.__domElements.menu.querySelectorAll("."+A);t.length&&t.forEach(H)},O.prototype.__activateMenuItem=function(t){this.__clearActiveItems();var e=t.closest(k);if(e){var n=t.closest(D);n.classList.add(A),(n=e.closest(D)).classList.add(A),n.classList.add(N),r(n,"aria-expanded")}else{var s=t.closest(D);s.classList.add(A),s.querySelector(k)&&(s.classList.add(N),r(s,"aria-expanded"))}},O.prototype.__dropdownClickHandler=function(t){var e=t.closest(D);e.classList.toggle(N),r(e,"aria-expanded")},O.prototype.__attachListeners=function(){this.__eventDisposers=[],this.__eventDisposers.push(e(this.__domElements.menu,"click",w,this.__activateMenuItem.bind(this))),this.__eventDisposers.push(e(this.__domElements.menu,"click",L,this.__dropdownClickHandler.bind(this))),this.__eventDisposers.push(n(this.__domElements.menu,"scroll",(function(t){var e=t.target;e.classList.add(S),setTimeout((function(){var t=e.scrollHeight-e.clientHeight<=e.scrollTop+1;(0==e.scrollTop||t)&&e.classList.remove(S)}),600)})))};var P=function(t){if(!(t=t||{}).useLayoutRoot&&!t.useMenu)throw new Error("Uxpl.LeftNav: Could not initialize Uxpl.LeftNav. You need to provide either the menu element or the layoutRoot element");var e=t.useLayoutRoot,n=t.useMenu;e&&(this.layout=new x({layoutRoot:e,collapse:t.collapse}),n=i(n,{parent:e,selector:y})),this.menu=new O(n)};P.createWithLayout=function(t){return new P({useLayoutRoot:t})},P.createMenuOnly=function(t){return new P({useMenu:t})},P.prototype.destroy=function(){this.menu&&this.menu.destroy(),this.layout&&this.layout.destroy()},t.Dropdown=a,t.GlobalNav=E,t.LeftNav=P,Object.defineProperty(t,"__esModule",{value:!0})}));
