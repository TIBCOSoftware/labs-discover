{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { CustomParameterDecorator } from './CustomParameterDecorator';\nimport { BaseDriver } from './driver/BaseDriver';\nimport { ExpressDriver } from './driver/express/ExpressDriver';\nimport { KoaDriver } from './driver/koa/KoaDriver';\nimport { MetadataArgsStorage } from './metadata-builder/MetadataArgsStorage';\nimport { RoutingControllers } from './RoutingControllers';\nimport { RoutingControllersOptions } from './RoutingControllersOptions';\nimport { ValidationOptions } from 'class-validator';\nimport { importClassesFromDirectories } from './util/importClassesFromDirectories';\n\n// -------------------------------------------------------------------------\n// Main exports\n// -------------------------------------------------------------------------\n\nexport * from './container';\n\nexport * from './decorator/All';\nexport * from './decorator/Authorized';\nexport * from './decorator/Body';\nexport * from './decorator/BodyParam';\nexport * from './decorator/ContentType';\nexport * from './decorator/Controller';\nexport * from './decorator/CookieParam';\nexport * from './decorator/CookieParams';\nexport * from './decorator/Ctx';\nexport * from './decorator/CurrentUser';\nexport * from './decorator/Delete';\nexport * from './decorator/Get';\nexport * from './decorator/Head';\nexport * from './decorator/Header';\nexport * from './decorator/HeaderParam';\nexport * from './decorator/HeaderParams';\nexport * from './decorator/HttpCode';\nexport * from './decorator/Interceptor';\nexport * from './decorator/JsonController';\nexport * from './decorator/Location';\nexport * from './decorator/Method';\nexport * from './decorator/Middleware';\nexport * from './decorator/OnNull';\nexport * from './decorator/OnUndefined';\nexport * from './decorator/Param';\nexport * from './decorator/Params';\nexport * from './decorator/Patch';\nexport * from './decorator/Post';\nexport * from './decorator/Put';\nexport * from './decorator/QueryParam';\nexport * from './decorator/QueryParams';\nexport * from './decorator/Redirect';\nexport * from './decorator/Render';\nexport * from './decorator/Req';\nexport * from './decorator/Res';\nexport * from './decorator/ResponseClassTransformOptions';\nexport * from './decorator/Session';\nexport * from './decorator/SessionParam';\nexport * from './decorator/State';\nexport * from './decorator/UploadedFile';\nexport * from './decorator/UploadedFiles';\nexport * from './decorator/UseAfter';\nexport * from './decorator/UseBefore';\nexport * from './decorator/UseInterceptor';\n\nexport * from './decorator-options/BodyOptions';\nexport * from './decorator-options/ParamOptions';\nexport * from './decorator-options/UploadOptions';\n\nexport * from './http-error/HttpError';\nexport * from './http-error/InternalServerError';\nexport * from './http-error/BadRequestError';\nexport * from './http-error/ForbiddenError';\nexport * from './http-error/NotAcceptableError';\nexport * from './http-error/MethodNotAllowedError';\nexport * from './http-error/NotFoundError';\nexport * from './http-error/UnauthorizedError';\n\nexport * from './driver/express/ExpressMiddlewareInterface';\nexport * from './driver/express/ExpressErrorMiddlewareInterface';\nexport * from './driver/koa/KoaMiddlewareInterface';\nexport * from './metadata-builder/MetadataArgsStorage';\nexport * from './metadata/ActionMetadata';\nexport * from './metadata/ControllerMetadata';\nexport * from './metadata/InterceptorMetadata';\nexport * from './metadata/MiddlewareMetadata';\nexport * from './metadata/ParamMetadata';\nexport * from './metadata/ResponseHandleMetadata';\nexport * from './metadata/UseMetadata';\n\nexport * from './RoutingControllersOptions';\nexport * from './CustomParameterDecorator';\nexport * from './RoleChecker';\nexport * from './Action';\nexport * from './InterceptorInterface';\n\nexport * from './driver/BaseDriver';\nexport * from './driver/express/ExpressDriver';\nexport * from './driver/koa/KoaDriver';\n\n// -------------------------------------------------------------------------\n// Main Functions\n// -------------------------------------------------------------------------\n\n/**\n * Gets metadata args storage.\n * Metadata args storage follows the best practices and stores metadata in a global variable.\n */\nexport function getMetadataArgsStorage(): MetadataArgsStorage {\n  if (!(global as any).routingControllersMetadataArgsStorage)\n    (global as any).routingControllersMetadataArgsStorage = new MetadataArgsStorage();\n\n  return (global as any).routingControllersMetadataArgsStorage;\n}\n\n/**\n * Registers all loaded actions in your express application.\n */\nexport function useExpressServer<T>(expressServer: T, options?: RoutingControllersOptions): T {\n  const driver = new ExpressDriver(expressServer);\n  return createServer(driver, options);\n}\n\n/**\n * Registers all loaded actions in your express application.\n */\nexport function createExpressServer(options?: RoutingControllersOptions): any {\n  const driver = new ExpressDriver();\n  return createServer(driver, options);\n}\n\n/**\n * Registers all loaded actions in your koa application.\n */\nexport function useKoaServer<T>(koaApp: T, options?: RoutingControllersOptions): T {\n  const driver = new KoaDriver(koaApp);\n  return createServer(driver, options);\n}\n\n/**\n * Registers all loaded actions in your koa application.\n */\nexport function createKoaServer(options?: RoutingControllersOptions): any {\n  const driver = new KoaDriver();\n  return createServer(driver, options);\n}\n\n/**\n * Registers all loaded actions in your application using selected driver.\n */\nexport function createServer<T extends BaseDriver>(driver: T, options?: RoutingControllersOptions): any {\n  createExecutor(driver, options);\n  return driver.app;\n}\n\n/**\n * Registers all loaded actions in your express application.\n */\nexport function createExecutor<T extends BaseDriver>(driver: T, options: RoutingControllersOptions = {}): void {\n  // import all controllers and middlewares and error handlers (new way)\n  let controllerClasses: Function[];\n  if (options && options.controllers && options.controllers.length) {\n    controllerClasses = (options.controllers as any[]).filter(controller => controller instanceof Function);\n    const controllerDirs = (options.controllers as any[]).filter(controller => typeof controller === 'string');\n    controllerClasses.push(...importClassesFromDirectories(controllerDirs));\n  }\n  let middlewareClasses: Function[];\n  if (options && options.middlewares && options.middlewares.length) {\n    middlewareClasses = (options.middlewares as any[]).filter(controller => controller instanceof Function);\n    const middlewareDirs = (options.middlewares as any[]).filter(controller => typeof controller === 'string');\n    middlewareClasses.push(...importClassesFromDirectories(middlewareDirs));\n  }\n  let interceptorClasses: Function[];\n  if (options && options.interceptors && options.interceptors.length) {\n    interceptorClasses = (options.interceptors as any[]).filter(controller => controller instanceof Function);\n    const interceptorDirs = (options.interceptors as any[]).filter(controller => typeof controller === 'string');\n    interceptorClasses.push(...importClassesFromDirectories(interceptorDirs));\n  }\n\n  if (options && options.development !== undefined) {\n    driver.developmentMode = options.development;\n  } else {\n    driver.developmentMode = process.env.NODE_ENV !== 'production';\n  }\n\n  if (options.defaultErrorHandler !== undefined) {\n    driver.isDefaultErrorHandlingEnabled = options.defaultErrorHandler;\n  } else {\n    driver.isDefaultErrorHandlingEnabled = true;\n  }\n\n  if (options.classTransformer !== undefined) {\n    driver.useClassTransformer = options.classTransformer;\n  } else {\n    driver.useClassTransformer = true;\n  }\n\n  if (options.validation !== undefined) {\n    driver.enableValidation = !!options.validation;\n    if (options.validation instanceof Object) driver.validationOptions = options.validation as ValidationOptions;\n  } else {\n    driver.enableValidation = true;\n  }\n\n  driver.classToPlainTransformOptions = options.classToPlainTransformOptions;\n  driver.plainToClassTransformOptions = options.plainToClassTransformOptions;\n\n  if (options.errorOverridingMap !== undefined) driver.errorOverridingMap = options.errorOverridingMap;\n\n  if (options.routePrefix !== undefined) driver.routePrefix = options.routePrefix;\n\n  if (options.currentUserChecker !== undefined) driver.currentUserChecker = options.currentUserChecker;\n\n  if (options.authorizationChecker !== undefined) driver.authorizationChecker = options.authorizationChecker;\n\n  driver.cors = options.cors;\n\n  // next create a controller executor\n  new RoutingControllers(driver, options)\n    .initialize()\n    .registerInterceptors(interceptorClasses)\n    .registerMiddlewares('before', middlewareClasses)\n    .registerControllers(controllerClasses)\n    .registerMiddlewares('after', middlewareClasses); // todo: register only for loaded controllers?\n}\n\n/**\n * Registers custom parameter decorator used in the controller actions.\n */\nexport function createParamDecorator(options: CustomParameterDecorator) {\n  return function (object: Object, method: string, index: number) {\n    getMetadataArgsStorage().params.push({\n      type: 'custom-converter',\n      object: object,\n      method: method,\n      index: index,\n      parse: false,\n      required: options.required,\n      transform: options.value,\n    });\n  };\n}\n"]}